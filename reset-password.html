<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password | Trust ZedFund</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; color:#222; margin:0; padding:0; }
    .container { max-width: 400px; margin:auto; padding:20px; }
    h2 { text-align:center; margin-bottom:10px; }
    input { width:100%; padding:12px; margin-bottom:12px; border-radius:8px; border:1px solid #ccc; }
    button { width:100%; padding:12px; border:none; border-radius:8px; background:#2e7dff; color:#fff; cursor:pointer; }
    .message { text-align:center; font-size:14px; margin-top:10px; }
  </style>
</head>
<body>

<div class="container">
  <h2>Reset Password</h2>
  <input type="password" id="newPassword" placeholder="Enter new password (min 6 chars)" />
  <input type="password" id="confirmPassword" placeholder="Confirm new password" />
  <button id="updatePasswordBtn">Update Password</button>
  <div class="message" id="updateMessage"></div>
</div>

<script type="module">
import { auth } from "./firebase.js";
import { confirmPasswordReset } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

// Parse oobCode from URL (Firebase reset link)
const params = new URLSearchParams(window.location.search);
const oobCode = params.get("oobCode");

const newPasswordInput = document.getElementById("newPassword");
const confirmPasswordInput = document.getElementById("confirmPassword");
const updateBtn = document.getElementById("updatePasswordBtn");
const updateMessage = document.getElementById("updateMessage");

if (!oobCode) {
  updateMessage.style.color = "red";
  updateMessage.textContent = "Invalid or expired password reset link.";
}

updateBtn.addEventListener("click", async () => {
  const newPass = newPasswordInput.value.trim();
  const confirmPass = confirmPasswordInput.value.trim();
  updateMessage.textContent = "";

  if (newPass.length < 6) {
    updateMessage.style.color = "red";
    updateMessage.textContent = "Password must be at least 6 characters.";
    return;
  }
  if (newPass !== confirmPass) {
    updateMessage.style.color = "red";
    updateMessage.textContent = "Passwords do not match.";
    return;
  }

  try {
    await confirmPasswordReset(auth, oobCode, newPass);
    updateMessage.style.color = "green";
    updateMessage.textContent = "Password updated successfully! You can now login.";
  } catch (err) {
    console.error(err);
    updateMessage.style.color = "red";
    updateMessage.textContent = "Failed to reset password. Link may be expired.";
  }
});
</script>

</body>
</html>
