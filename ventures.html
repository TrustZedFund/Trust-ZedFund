<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trust ZedFund Ventures</title>
<style>
body { font-family: sans-serif; background: #f5f7f9; padding: 20px; }
h1,h2 { color:#0A2540; }
.venture-card { border: 1px solid #0A2540; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #fff; transition: transform 0.2s; }
.venture-card:hover { transform: scale(1.02); }
button { background: #0A2540; color: #fff; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; }
button:disabled { opacity: 0.6; cursor: not-allowed; }
</style>
</head>
<body>

<h1>Available Ventures</h1>
<div id="venturesList"></div>

<h2>My Wallet</h2>
<p>Available Balance: ZMW <span id="walletBalance">0</span></p>

<h2>Transaction History</h2>
<div id="transactionsList"></div>

<script type="module">
import { 
  initUser, addToWallet, allocateToVenture, onWalletChange, onTransactionsChange, onVenturesChange 
} from './firebase.js';

const userId = "demo_user"; // Replace with actual auth.uid
await initUser(userId, "Demo User", "demo@example.com");

// -------------------
// LIVE WALLET
// -------------------
const walletBalanceEl = document.getElementById('walletBalance');
onWalletChange(userId, wallet => {
  walletBalanceEl.textContent = wallet.available;
});

// -------------------
// LIVE TRANSACTIONS
// -------------------
const transactionsList = document.getElementById('transactionsList');
onTransactionsChange(userId, txns => {
  transactionsList.innerHTML = '';
  Object.values(txns).forEach(t => {
    const div = document.createElement('div');
    div.textContent = `${t.date}: ${t.type} ZMW ${t.amount} â†’ ${t.to} [${t.status}]`;
    transactionsList.appendChild(div);
  });
});

// -------------------
// LIVE VENTURES
// -------------------
const venturesList = document.getElementById('venturesList');
onVenturesChange(ventures => {
  venturesList.innerHTML = '';
  Object.keys(ventures).forEach(id => {
    const v = ventures[id];
    const div = document.createElement('div');
    div.className = 'venture-card';
    div.innerHTML = `
      <h3>${v.name}</h3>
      <p>${v.description}</p>
      <p>Total Raised: ZMW ${v.totalAllocated || 0}</p>
      <input type="number" placeholder="Amount ZMW" id="amt_${id}" />
      <button id="btn_${id}">Support Venture</button>
    `;
    venturesList.appendChild(div);

    const btn = document.getElementById(`btn_${id}`);
    btn.addEventListener('click', async () => {
      const amt = Number(document.getElementById(`amt_${id}`).value);
      if (!amt || amt <= 0) { alert("Enter valid amount"); return; }
      btn.disabled = true;
      try {
        const result = await allocateToVenture(userId, id, amt);
        alert(`Success! New wallet: ZMW ${result.newWallet}, Venture Total: ZMW ${result.ventureTotal}`);
      } catch(err) { alert(err.message); }
      btn.disabled = false;
    });
  });
});
</script>

</body>
</html>
