<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Confirm Investment</title>

<style>
:root{
  --bg:#083a34;
  --card:#10c7a7;
  --card2:#0b5f56;
  --accent:#22ff9a;
  --text:#ffffff;
  --muted:#d6f1ec;
}
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{margin:0;background:var(--bg);color:white}
.card{
  margin:18px;
  background:linear-gradient(135deg,var(--card),var(--card2));
  border-radius:18px;
  padding:20px;
}
.row{display:flex;justify-content:space-between;margin:10px 0}
input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  margin-top:8px;
}
button{
  width:100%;
  padding:16px;
  border-radius:30px;
  border:none;
  margin-top:18px;
  font-weight:600;
  background:linear-gradient(90deg,var(--accent),#00d4ff);
  color:#00352f;
  cursor:pointer;
}
.note{font-size:12px;opacity:.95;margin-top:14px}
</style>
</head>

<body>

<div class="card">
  <h3 id="planName">—</h3>

  <div class="row">
    <span>Withdrawable After</span>
    <strong id="planDays">—</strong>
  </div>

  <label>Amount to invest (Minimum ZMK 500)</label>
  <input id="amount" type="number" min="500" placeholder="Enter amount"/>

  <div id="summary" class="note">
    Enter amount to see daily earnings
  </div>

  <button id="confirmBtn">Confirm Investment</button>

  <div class="note">
    • You earn profit every day<br>
    • Profit continues even after maturity<br>
    • You can withdraw anytime after maturity<br>
    • Earnings go to Earnings Wallet
  </div>
</div>

<script type="module">
import { auth, createInvestment } from "./js/firebase.js";
import { onAuthStateChanged } from
"https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

const plan = JSON.parse(localStorage.getItem("selectedPlan"));
if(!plan){
  alert("No plan selected");
  location.href="investments.html";
}

document.getElementById("planName").textContent = plan.name;
document.getElementById("planDays").textContent = plan.days + " days";

const amountEl = document.getElementById("amount");
const summary = document.getElementById("summary");
const btn = document.getElementById("confirmBtn");

let user=null;
onAuthStateChanged(auth,u=>{
  if(!u) location.href="login.html";
  user=u;
});

amountEl.addEventListener("input",()=>{
  const amt = Number(amountEl.value);
  if(!amt || amt<500){
    summary.innerHTML="Enter at least ZMK 500";
    return;
  }
  const daily=(amt/500)*10;
  summary.innerHTML=
    `Daily profit: <strong>ZMK ${daily.toFixed(2)}</strong>`;
});

btn.addEventListener("click", async ()=>{
  const amt = Number(amountEl.value);
  if(!amt || amt<500){
    alert("Minimum investment is ZMK 500");
    return;
  }
  btn.disabled=true;
  try{
    await createInvestment(user.uid, plan, amt);
    alert("Investment started successfully");
    localStorage.removeItem("selectedPlan");
    location.href="dashboard.html";
  }catch(e){
    alert(e.message);
  }
  btn.disabled=false;
});
</script>

</body>
</html>
