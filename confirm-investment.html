<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Confirm Investment</title>

<style>
:root{
  --bg:#083a34;
  --card:#10c7a7;
  --card2:#0b5f56;
  --accent:#22ff9a;
  --text:#ffffff;
  --muted:#d6f1ec;
}

*{
  box-sizing:border-box;
  font-family:system-ui,sans-serif;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:20px;
}

.card{
  margin:16px;
  background:linear-gradient(135deg,var(--card),var(--card2));
  border-radius:18px;
  padding:20px;
}

.row{
  display:flex;
  justify-content:space-between;
  margin:10px 0;
}

input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  margin-top:10px;
  font-size:16px;
}

.summary{
  margin-top:14px;
  font-size:14px;
  line-height:1.5;
}

button{
  width:100%;
  padding:16px;
  border-radius:30px;
  border:none;
  margin-top:18px;
  font-weight:600;
  font-size:16px;
  background:linear-gradient(90deg,var(--accent),#00d4ff);
  color:#00352f;
  cursor:pointer;
  position:relative;
  z-index:10;
}
</style>
</head>

<body>

<header>
  <h2>Confirm Investment</h2>
</header>

<div class="card">
  <h3 id="planName">â€”</h3>

  <div class="row">
    <span>Duration</span>
    <strong id="planDuration">â€”</strong>
  </div>

  <label>Amount to invest (ZMW)</label>
  <input id="amount" type="number" placeholder="Enter amount" />

  <div class="summary" id="summary">
    Enter an amount to see payout
  </div>

  <button id="confirmBtn">Confirm Investment</button>
</div>

<!-- ðŸ”¥ FIREBASE MODULE -->
<script type="module">
import { auth, createInvestment } from "./js/firebase.js";
import { onAuthStateChanged } from
  "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

/* âœ… PROOF JS IS RUNNING */
console.log("JS running");
alert("Page loaded");

const plan = JSON.parse(localStorage.getItem("selectedPlan"));

if (!plan) {
  alert("No plan selected");
  location.href = "investments.html";
}

document.getElementById("planName").textContent = plan.name;
document.getElementById("planDuration").textContent = plan.days + " days";

const amountEl = document.getElementById("amount");
const summaryEl = document.getElementById("summary");
const btn = document.getElementById("confirmBtn");

/* LIVE CALCULATOR */
amountEl.addEventListener("input", () => {
  const amount = Number(amountEl.value);
  if (!amount) {
    summaryEl.textContent = "Enter an amount to see payout";
    return;
  }

  const profit = amount * plan.percent / 100;
  summaryEl.innerHTML = `
    You invest <b>ZMW ${amount}</b><br>
    Profit <b>ZMW ${profit}</b><br>
    Total <b>ZMW ${amount + profit}</b>
  `;
});

/* ðŸ”¥ BUTTON CLICK */
btn.addEventListener("click", () => {
  alert("Button clicked"); // â† THIS MUST SHOW

  const amount = Number(amountEl.value);
  if (!amount) {
    alert("Enter amount");
    return;
  }

  btn.disabled = true;
  btn.textContent = "Processing...";

  onAuthStateChanged(auth, async user => {
    if (!user) {
      alert("Login required");
      btn.disabled = false;
      btn.textContent = "Confirm Investment";
      return;
    }

    try {
      await createInvestment(user.uid, plan, amount);
      alert("Investment successful");
      localStorage.removeItem("selectedPlan");
      location.href = "dashboard.html";
    } catch (e) {
      alert(e.message);
      btn.disabled = false;
      btn.textContent = "Confirm Investment";
    }
  });
});
</script>

</body>
</html>
