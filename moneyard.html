<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Moneyard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{margin:0;display:flex;height:100vh;background:#052e2b;color:#fff}
.sidebar{width:230px;background:#022c22;padding:24px 16px}
.logo{font-size:22px;font-weight:700;color:#facc15;margin-bottom:40px}
.nav a{display:block;padding:12px;border-radius:10px;color:#fff;text-decoration:none;margin-bottom:8px}
.nav a.active,.nav a:hover{background:#064e3b}
.main{flex:1;padding:24px;overflow-y:auto}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.search{background:#022c22;border:none;color:#fff;padding:10px;border-radius:10px}
.card{background:#022c22;border-radius:18px;padding:22px;margin-bottom:20px}
.balance-hero h1{margin:0;font-size:38px}
.balance-hero span{color:#facc15}
.accounts{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}
.account-card h3{margin:0;font-size:14px;opacity:.8}
.account-card p{font-size:24px;margin-top:10px}
.actions{display:flex;gap:12px;margin-bottom:24px}
.action-btn{flex:1;padding:14px;border:none;border-radius:14px;cursor:pointer;background:#064e3b;color:#fff}
.action-btn.primary{background:#facc15;color:#052e2b;font-weight:600}
.transactions{display:grid;grid-template-columns:2fr 1fr;gap:16px}
.tx-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #064e3b}
.tx-meta{font-size:12px;opacity:.7}
.positive{color:#facc15}
.negative{color:#ef4444}
#txModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);align-items:center;justify-content:center;z-index:10}
.modal{background:#022c22;width:90%;max-width:420px;padding:22px;border-radius:18px}
.modal input,.modal select{width:100%;padding:12px;margin-bottom:10px;border:none;border-radius:12px;background:#052e2b;color:#fff}
#mobileNav{display:none;position:fixed;bottom:0;left:0;right:0;background:#022c22;justify-content:space-around;padding:12px}
@media(max-width:900px){
  .sidebar{display:none}
  .transactions{grid-template-columns:1fr}
  #mobileNav{display:flex}
  body{padding-bottom:60px}
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">Moneyard</div>
  <nav class="nav">
    <a class="active">Dashboard</a>
    <a>Accounts</a>
    <a>Activity</a>
    <a>Settings</a>
  </nav>
</aside>

<!-- MAIN -->
<main class="main">

<div id="authBox" class="card" style="text-align:center">
  <h3>Sign in to Moneyard</h3>
  <button class="action-btn primary" onclick="loginGoogle()">üîê Sign in with Google</button>
</div>

<div class="topbar">
  <select id="currencySelect" class="search">
    <option value="USD">USD</option>
    <option value="EUR">EUR</option>
    <option value="KES">KES</option>
  </select>
  <div id="userName">üë§</div>
</div>

<div class="card balance-hero">
  <h1 id="totalBalance">USD 0.00</h1>
  <span>Live balance</span>
</div>

<div class="accounts">
  <div class="card account-card"><h3>üíµ Cash</h3><p id="cashBal">USD 0.00</p></div>
  <div class="card account-card"><h3>üì± Mobile Money</h3><p id="mobileBal">USD 0.00</p></div>
  <div class="card account-card"><h3>‚Çø Crypto</h3><p id="cryptoBal">USD 0.00</p></div>
</div>

<div class="actions">
  <button class="action-btn primary" onclick="openModal()">‚ûï Add Transaction</button>
</div>

<div class="transactions">
  <div class="card">
    <h3>Recent Transactions</h3>
    <div id="txList"></div>
  </div>
  <div class="card">
    <h3>Money Flow</h3>
    <select id="chartRange" class="search" style="margin-bottom:10px">
      <option value="7">Last 7 days</option>
      <option value="30">Last 30 days</option>
    </select>
    <canvas id="flowChart" height="160"></canvas>
  </div>
</div>

</main>

<!-- MOBILE NAV -->
<div id="mobileNav">
  <span>üè†</span>
  <span onclick="openModal()">‚ûï</span>
  <span>üìä</span>
  <span>‚öôÔ∏è</span>
</div>

<!-- MODAL -->
<div id="txModal">
  <div class="modal">
    <h3>Add Transaction</h3>
    <input id="amount" type="number" placeholder="Amount">
    <select id="type">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
      <option value="transfer">Transfer</option>
    </select>
    <select id="from">
      <option value="cash">Cash</option>
      <option value="mobile_money">Mobile Money</option>
      <option value="crypto">Crypto</option>
    </select>
    <select id="to">
      <option value="">To (transfer only)</option>
      <option value="cash">Cash</option>
      <option value="mobile_money">Mobile Money</option>
      <option value="crypto">Crypto</option>
    </select>
    <input id="note" placeholder="Note">
    <button class="action-btn primary" onclick="saveTx()">Save</button>
    <button class="action-btn" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, push, update, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

/* üî• INSERT YOUR FIREBASE CONFIG HERE üî• */
const firebaseConfig = {};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

/* DOM BINDINGS */
const txModal = document.getElementById("txModal");
const amount = document.getElementById("amount");
const type = document.getElementById("type");
const from = document.getElementById("from");
const to = document.getElementById("to");
const note = document.getElementById("note");
const currencySelect = document.getElementById("currencySelect");
const chartRange = document.getElementById("chartRange");
const txList = document.getElementById("txList");

let uid = null;
let balances = { cash:0, mobile_money:0, crypto:0 };
let rates = { USD:1 };
let currency = "USD";
let allTx = [];
let chart = null;

/* AUTH */
window.loginGoogle = async () => {
  const r = await signInWithPopup(auth, provider);
  uid = r.user.uid;
  userName.textContent = r.user.displayName;
  authBox.style.display = "none";
  set(ref(db, `users/${uid}/balances`), balances);
  loadRates();
  listenBalances();
  listenTx();
};

/* FX */
async function loadRates(){
  const res = await fetch("https://api.exchangerate.host/latest?base=USD");
  const data = await res.json();
  rates = data.rates;
}

/* BALANCES */
function listenBalances(){
  onValue(ref(db, `users/${uid}/balances`), s=>{
    balances = s.val() || balances;
    renderBalances();
  });
}

function renderBalances(){
  const r = rates[currency] || 1;
  cashBal.textContent = format(balances.cash * r);
  mobileBal.textContent = format(balances.mobile_money * r);
  cryptoBal.textContent = format(balances.crypto * r);
  totalBalance.textContent = format(
    (balances.cash + balances.mobile_money + balances.crypto) * r
  );
}

currencySelect.addEventListener("change", e=>{
  currency = e.target.value;
  renderBalances();
});

function format(v){ return `${currency} ${v.toFixed(2)}` }

/* TRANSACTIONS */
function listenTx(){
  onValue(ref(db, `users/${uid}/transactions`), s=>{
    txList.innerHTML = "";
    allTx = [];
    s.forEach(c=>{
      const t = c.val();
      allTx.push(t);
      const d = document.createElement("div");
      d.className = "tx-item";
      d.innerHTML = `
        <div>
          <div>${t.note || t.type}</div>
          <div class="tx-meta">${t.from}${t.to?" ‚Üí "+t.to:""}</div>
        </div>
        <div class="${t.type==="income"?"positive":"negative"}">
          ${t.type==="income"?"+":"-"}${format(t.amount*(rates[currency]||1))}
        </div>`;
      txList.prepend(d);
    });
    renderChart();
  });
}

/* CHART */
function renderChart(){
  const days = Number(chartRange.value);
  const labels=[], data=[];
  for(let i=days-1;i>=0;i--){
    const d=new Date(Date.now()-i*86400000);
    labels.push(d.toLocaleDateString());
    let sum=0;
    allTx.forEach(t=>{
      if(new Date(t.timestamp).toDateString()===d.toDateString()){
        sum+=t.type==="income"?t.amount:-t.amount;
      }
    });
    data.push(sum);
  }
  if(chart) chart.destroy();
  chart = new Chart(flowChart,{
    type:"bar",
    data:{labels,datasets:[{data,backgroundColor:"#facc15"}]},
    options:{plugins:{legend:{display:false}}}
  });
}

chartRange.onchange = renderChart;

/* MODAL */
window.openModal = ()=>{
  if(!uid) return alert("Please sign in first");
  txModal.style.display="flex";
};

window.closeModal = ()=>{
  txModal.style.display="none";
};

/* SAVE TX */
window.saveTx = ()=>{
  if(!uid) return alert("Not authenticated");
  const amt = Number(amount.value);
  if(!amt || amt<=0) return alert("Enter valid amount");

  const t = type.value;
  const f = from.value;
  const toVal = to.value;

  if(t==="transfer" && (!toVal || f===toVal))
    return alert("Invalid transfer");

  if(t==="income") balances[f]+=amt;
  if(t==="expense") balances[f]-=amt;
  if(t==="transfer"){
    balances[f]-=amt;
    balances[toVal]+=amt;
  }

  update(ref(db,`users/${uid}/balances`), balances);
  push(ref(db,`users/${uid}/transactions`),{
    amount:amt,type:t,from:f,to:toVal||null,note:note.value,timestamp:Date.now()
  });

  closeModal();
};
</script>

</body>
</html>
